{"ast":null,"code":"import _regeneratorRuntime from\"D:/Humber 2023/Semester 3/Capstone Project/urban_clothing_v1.0/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"D:/Humber 2023/Semester 3/Capstone Project/urban_clothing_v1.0/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"D:/Humber 2023/Semester 3/Capstone Project/urban_clothing_v1.0/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useState}from\"react\";import{PaymentElement,LinkAuthenticationElement,useStripe,useElements}from\"@stripe/react-stripe-js\";import{useSelector}from\"react-redux\";import{selectOrderCurrent}from\"../features/order/orderSlice\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function CheckoutForm(){var _ref2;var stripe=useStripe();var elements=useElements();var orderCurrent=useSelector(selectOrderCurrent);var _useState=useState(''),_useState2=_slicedToArray(_useState,2),email=_useState2[0],setEmail=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),message=_useState4[0],setMessage=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isLoading=_useState6[0],setIsLoading=_useState6[1];useEffect(function(){if(!stripe){return;}var clientSecret=new URLSearchParams(window.location.search).get(\"payment_intent_client_secret\");if(!clientSecret){return;}stripe.retrievePaymentIntent(clientSecret).then(function(_ref){var paymentIntent=_ref.paymentIntent;switch(paymentIntent.status){case\"succeeded\":setMessage(\"Payment succeeded!\");break;case\"processing\":setMessage(\"Your payment is processing.\");break;case\"requires_payment_method\":setMessage(\"Your payment was not successful, please try again.\");break;default:setMessage(\"Something went wrong.\");break;}});},[stripe]);var handleSubmit=function handleSubmit(_x){return(_ref2=_ref2||_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(e){var _yield$stripe$confirm,error;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:e.preventDefault();if(!(!stripe||!elements)){_context.next=3;break;}return _context.abrupt(\"return\");case 3:setIsLoading(true);_context.next=6;return stripe.confirmPayment({elements:elements,confirmParams:{// Make sure to change this to your payment completion page\nreturn_url:\"/ordersuccess/\".concat(orderCurrent.id)}});case 6:_yield$stripe$confirm=_context.sent;error=_yield$stripe$confirm.error;// This point will only be reached if there is an immediate error when\n// confirming the payment. Otherwise, your customer will be redirected to\n// your `return_url`. For some payment methods like iDEAL, your customer will\n// be redirected to an intermediate site first to authorize the payment, then\n// redirected to the `return_url`.\nif(error.type===\"card_error\"||error.type===\"validation_error\"){setMessage(error.message);}else{setMessage(\"An unexpected error occurred.\");}setIsLoading(false);case 10:case\"end\":return _context.stop();}},_callee);}))).apply(this,arguments);};var paymentElementOptions={layout:\"tabs\"};return/*#__PURE__*/_jsxs(\"form\",{id:\"payment-form\",onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(LinkAuthenticationElement,{id:\"link-authentication-element\",onChange:function onChange(e){return setEmail(e.target.value);}}),/*#__PURE__*/_jsx(PaymentElement,{id:\"payment-element\",options:paymentElementOptions}),/*#__PURE__*/_jsx(\"button\",{disabled:isLoading||!stripe||!elements,id:\"submit\",children:/*#__PURE__*/_jsx(\"span\",{id:\"button-text\",children:isLoading?/*#__PURE__*/_jsx(\"div\",{className:\"spinner\",id:\"spinner\"}):\"Pay now\"})}),message&&/*#__PURE__*/_jsx(\"div\",{id:\"payment-message\",children:message})]});}","map":{"version":3,"names":["React","useEffect","useState","PaymentElement","LinkAuthenticationElement","useStripe","useElements","useSelector","selectOrderCurrent","jsx","_jsx","jsxs","_jsxs","CheckoutForm","_ref2","stripe","elements","orderCurrent","_useState","_useState2","_slicedToArray","email","setEmail","_useState3","_useState4","message","setMessage","_useState5","_useState6","isLoading","setIsLoading","clientSecret","URLSearchParams","window","location","search","get","retrievePaymentIntent","then","_ref","paymentIntent","status","handleSubmit","_x","_asyncToGenerator","_regeneratorRuntime","mark","_callee","e","_yield$stripe$confirm","error","wrap","_callee$","_context","prev","next","preventDefault","abrupt","confirmPayment","confirmParams","return_url","concat","id","sent","type","stop","apply","arguments","paymentElementOptions","layout","onSubmit","children","onChange","target","value","options","disabled","className"],"sources":["D:/Humber 2023/Semester 3/Capstone Project/urban_clothing_v1.0/src/pages/CheckoutForm.js"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport {\r\n  PaymentElement,\r\n  LinkAuthenticationElement,\r\n  useStripe,\r\n  useElements\r\n} from \"@stripe/react-stripe-js\";\r\nimport { useSelector } from \"react-redux\";\r\nimport { selectOrderCurrent } from \"../features/order/orderSlice\";\r\n\r\nexport default function CheckoutForm() {\r\n  const stripe = useStripe();\r\n  const elements = useElements();\r\n  const orderCurrent = useSelector(selectOrderCurrent);\r\n\r\n  const [email, setEmail] = useState('');\r\n  const [message, setMessage] = useState(null);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (!stripe) {\r\n      return;\r\n    }\r\n\r\n    const clientSecret = new URLSearchParams(window.location.search).get(\r\n      \"payment_intent_client_secret\"\r\n    );\r\n\r\n    if (!clientSecret) {\r\n      return;\r\n    }\r\n\r\n    stripe.retrievePaymentIntent(clientSecret).then(({ paymentIntent }) => {\r\n      switch (paymentIntent.status) {\r\n        case \"succeeded\":\r\n          setMessage(\"Payment succeeded!\");\r\n          break;\r\n        case \"processing\":\r\n          setMessage(\"Your payment is processing.\");\r\n          break;\r\n        case \"requires_payment_method\":\r\n          setMessage(\"Your payment was not successful, please try again.\");\r\n          break;\r\n        default:\r\n          setMessage(\"Something went wrong.\");\r\n          break;\r\n      }\r\n    });\r\n  }, [stripe]);\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n\r\n    if (!stripe || !elements) {\r\n      // Stripe.js hasn't yet loaded.\r\n      // Make sure to disable form submission until Stripe.js has loaded.\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n\r\n    const { error } = await stripe.confirmPayment({\r\n      elements,\r\n      confirmParams: {\r\n        // Make sure to change this to your payment completion page\r\n        return_url: `/ordersuccess/${orderCurrent.id}`,\r\n      },\r\n    });\r\n\r\n    // This point will only be reached if there is an immediate error when\r\n    // confirming the payment. Otherwise, your customer will be redirected to\r\n    // your `return_url`. For some payment methods like iDEAL, your customer will\r\n    // be redirected to an intermediate site first to authorize the payment, then\r\n    // redirected to the `return_url`.\r\n    if (error.type === \"card_error\" || error.type === \"validation_error\") {\r\n      setMessage(error.message);\r\n    } else {\r\n      setMessage(\"An unexpected error occurred.\");\r\n    }\r\n\r\n    setIsLoading(false);\r\n  };\r\n\r\n  const paymentElementOptions = {\r\n    layout: \"tabs\"\r\n  }\r\n\r\n  return (\r\n    <form id=\"payment-form\" onSubmit={handleSubmit}>\r\n      <LinkAuthenticationElement\r\n        id=\"link-authentication-element\"\r\n        onChange={(e) => setEmail(e.target.value)}\r\n      />\r\n      <PaymentElement id=\"payment-element\" options={paymentElementOptions} />\r\n      <button disabled={isLoading || !stripe || !elements} id=\"submit\">\r\n        <span id=\"button-text\">\r\n          {isLoading ? <div className=\"spinner\" id=\"spinner\"></div> : \"Pay now\"}\r\n        </span>\r\n      </button>\r\n      {/* Show any error or success messages */}\r\n      {message && <div id=\"payment-message\">{message}</div>}\r\n    </form>\r\n  );\r\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}